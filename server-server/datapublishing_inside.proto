syntax = "proto3";
package bbproto; 

import "datapublishing.proto";
import "result.proto";
import "account.proto";
import "common_inside.proto";

// 每天的平均在线时间
message POnlineData {
	int64 date = 1;
	int32 value = 2;
}

message POnlineDataArray {
	repeated POnlineData array = 1;
}

/*
 *@note 批量获取最后心跳时间
 *@path /datapublishing/inside/heartbeat/last
 *@method GET
 *@param from 服务名，用于校验内网调用
 *@param uuids 用逗号分隔的一众uuid
 *@return 成功返回PInt64List，失败返回PResult
 */


message PQueryUserParam {
	string uuid = 1;
	string keyword = 2;
	int32 offset = 3;
	int32 size = 4;
}

message PScrollResult {
	// ids (如uuids等)
	repeated string id = 1;
	
	// 取下一页的游标
	string cursor = 2;
}

message PGroupString {
	string group = 1;
	repeated string list = 2;
}

message PGroupStringList {
	repeated PGroupString list = 1;
}

message PFansSaveParam {
	// 表名，存储在哪个表里面
	string table = 1;
	
	// 主键， key和id都赋值的话，变成组合主键
	string key = 2;
	int32 id = 3;
	
	// 勾选少部分用户时填充此字段，否则使用filter进行查询
	repeated string uuid = 4;
	
	// 筛选条件
	PFansFilterParam filter = 5;

	// 其它扩展内容
	string content = 6;
}

service grpcDataPublishing {
	// 查询粉丝
	rpc SelectFans(PFansFilterParam) returns (PScrollResult);
	
	// 查询粉丝，uuid中用下划线拼接了地区信息，如：uuid_CN;4403
	rpc SelectFansWithSource(PFansFilterParam) returns (PScrollResult);
	rpc MoreFansWithSource(PStringSingle) returns (PScrollResult);
	
	rpc SaveFans(PFansSaveParam) returns (PEmpty);

	// 用PScrollResult.scrollId查询下一页粉丝，直到PScrollResult.id为空
	rpc ScrollMore(PStringSingle) returns (PScrollResult);
	
	// 用户关注的网红列表，含搜索
	rpc SelectVUser(PQueryUserParam) returns (PGroupStringList);
	
	// 网红当天过生日的粉丝uuid
	rpc SelectTodayBirthdayFans(PStringSingle) returns (PScrollResult);
	
	// 网红7天内过生日的粉丝uuid
	rpc Select7DayBirthdayFans(PQueryUserParam) returns (PUserList);
	
	// 当天有粉丝过生日的网红uuid
	rpc SelectVUserHaveTodayBirthdayFans(PEmpty) returns (PStringList);
}